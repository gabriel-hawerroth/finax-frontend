<div class="simple-page login">
  <div class="login-box">
    <div class="top">
      <img
        [ngSrc]="cloudFireCdnImgsLink + 'money-coin.svg'"
        width="50"
        height="50"
        alt="company logo"
      />

      <h1>
        {{ "forgot-password.title" | translate }}
      </h1>
    </div>

    @if (!emailSent()) {
      <form>
        <div class="row">
          <mat-form-field style="width: 80%">
            <mat-label>{{ "generic.email" | translate }}</mat-label>
            <input
              type="text"
              matInput
              [formControl]="emailControl"
              autocomplete="off"
              autofocus
              maxlength="255"
            />
          </mat-form-field>
        </div>
      </form>

      <div class="bottom">
        @if (showLoading()) {
        <mat-spinner [diameter]="40"></mat-spinner>
        } @else {
        <app-buttons
          [showGeneric]="true"
          [genericStyle]="getBtnStyle('flat')"
          genericLabel="forgot-password.recovery"
          [disableGeneric]="emailControl.invalid"
          (onGeneric)="sendChangePasswordEmail()"
        ></app-buttons>
        }
      </div>
    }

    @if (emailSent()) {
      <div id="email-sent">
        <span class="success-message">
          {{ "forgot-password.email-sent-message" | translate }}
        </span>

        <!-- Resend Controls -->
        <div class="resend-controls">
          @if (!isBlocked()) {
            <app-buttons
              [showGeneric]="true"
              [genericStyle]="getBtnStyle('flat')"
              genericLabel="forgot-password.resend-email"
              genericIcon="email"
              [disableGeneric]="!resendAvailable() || showLoading()"
              (onGeneric)="resendPasswordResetEmail()"
            ></app-buttons>

            <div class="timer-info">
              @if (!resendAvailable() && remainingTime() > 0) {
                <p class="timer-text">
                  <span class="timer-label">{{ "forgot-password.available-in" | translate }}:</span>
                  <span class="timer-value">{{ formatTime(remainingTime()) }}</span>
                </p>
              }

              @if (resendAttempts() > 0) {
                <p class="attempts-text">
                  <span class="attempts-label">{{ "forgot-password.attempts-remaining" | translate }}:</span>
                  <span class="attempts-value">{{ 2 - resendAttempts() }}</span>
                </p>
              }
            </div>
          } @else {
            <p class="blocked-message">
              {{ "forgot-password.resend-blocked-message" | translate }}
            </p>
            <p class="timer-text blocked">
              <span class="timer-label">{{ "forgot-password.try-again-in" | translate }}:</span>
              <span class="timer-value">{{ formatTime(remainingTime()) }}</span>
            </p>
          }
        </div>
      </div>
    }
  </div>

  <span class="opt-login-page">
    <span routerLink="/login" class="action">
      {{ "create-account.do-login" | translate }}
    </span>
  </span>
</div>
